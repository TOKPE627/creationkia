<html lang="en" xmlns:th="http://www.w3.org/1000/xhtml"></html>
<div class="products-tab-area mt-45 mt-sm-45">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3 col-md-3 pr-0">
                <div class="section-title section-title-service">
                    <h2 class="category">Service </h2>
                </div>
            </div>
        </div>
        <div th:if="${serviceExist==true}" class="tab-content">
            <div class="tab-pane fade in show active">
                <div class="row product-carousel cv-visible">
                    <div class="col-lg-12 serviceProductContainer" data-th-each="service : ${serviceList}" >
                        <div th:if="${service.galery !=null and service.galery.companyImage !='' and service.galery.geolocateImage1 !='' and service.galery.geolocateImage2 !=''}"  
                         class="product-single" style="background-color:  #e8e8e8 !important;">
                            <div class="product-title"
                            >
                                <h4
                                style="font-size: 12px; text-align: center;"
                                 th:text="${#strings.abbreviate(service.name,18)}"
                                 ></h4>                                      

                             </div>
                            <div class="product-thumb">
                                <a th:href="@{/company/info/}+${service.id}"  
                                  >
                                   <img width="100%" height="150rem"
                                       class="img-responsive" style="object-fit: contain;"
                                       th:src="@{${awsBucketCompany}+${service.galery.id}+'/'+${service.galery.companyImage}}" alt=""  
                                  />   
                                 </a>
                            </div>
                            <!-- Not empty specialities -->
                             <div th:if="${not #lists.isEmpty(service.user.specialities)}" 
                              class="container" 
                              style=" margin-left: 5px; margin-top: 1.3rem !important;"
                               >
                                <div   style="height: 2.4rem !important;"  
                                   th:id="|resultSpeciality-${service.id}|"   
                                >      
                                </div>  
                                
                                <div class="row likeShareService">
                                       <h6 style="margin-left: 15px !important;" 
                                        th:onclick="|likeService('${service.id}')|"
                                            >
                                          <span>
                                            <a style="cursor: pointer;" >
                                              <i style="font-size: 10px;" class="fa fa-thumbs-up" aria-hidden="true"
                                              >
                                              </i> 
                                                <span style="color: #292828; font-size: 10px;"
                                                >Like
                                                </span>	
                                                <span style="font-size: 10px;" th:id="|resultLikeService-${service.id}|" ></span>
                                            </a>
                                           </span>
                                       </h6>	
                                     <h6 id="sewing" style="margin-left: 18%;" class="shareH">
                                        <span class="shareS">
                                         <a th:href="@{/socialNetwork/company/}+${service.id}">
                                             <i style="font-size: 10px; margin-left: 31px;" class="fa fa-share-alt" aria-hidden="true"></i>   
                                               <span style="color: #292828; font-size: 10px;">Partage</span> 
                                        </a>
                                       </span>
                                     </h6>
                                </div> 
                            </div>		 
                            <!--Empty specialities-->
                            <div th:if="${#lists.isEmpty(service.user.specialities)}" 
                            class="container" 
                            style=" margin-left: 5px; margin-top: 2.7rem !important;"
                             >          
                              <div class="row likeShareService">
                                     <h6 style="margin-left: 15px !important;" th:onclick="|likeService('${service.id}')|">
                                        <span>
                                          <a style="cursor: pointer;">
                                            <i style="font-size: 10px;" class="fa fa-thumbs-up" aria-hidden="true"></i> 
                                              <span style="color: #292828; font-size: 10px;"
                                                
                                              >Like
                                              </span>	
                                              <span style="font-size: 10px;" th:id="|resultLikeService-${service.id}|" ></span>
                                          </a>
                                         </span>
                                     </h6>	
                                   <h6 id="sewing" style="margin-left: 18%;" class="shareH">
                                      <span class="shareS">
                                       <a th:href="@{/socialNetwork/company/}+${service.id}">
                                           <i style="font-size: 10px; margin-left: 31px;" class="fa fa-share-alt" aria-hidden="true"></i>   
                                             <span style="color: #292828; font-size: 10px;">Partage</span> 
                                      </a>
                                     </span>
                                   </h6>
                              </div> 
                          </div>	
                        </div>
                    </div>
                </div>
            </div>	
        </div>
    </div>
</div>

<!-- jquery-3.3.1 version -->
<script th:src="@{/assets/js/vendor/jquery-3.2.1.min.js}"></script>
   
<script>
  	loadServices();
    function loadServices(){
		  $.ajax({
			  type: "GET",
			  contentType: "application/json",
			  url: '/company/services',
			  data: {},
			  dataType: 'json',
			  cache: false,
			  timeout: 600000,
			  success: function (data) {
				  var json = data.companies;
				  if(json){
					  $.each(json,function(index,company){
              getServiceLikes(company.id);
						  getSpecialities(company.id);
					  });
				  }
			  
			  },
			  error: function (e) {
				  console.log("ERROR : ", e);
			  }
		  }); 
		}
  	function getServiceLikes(service_id){
			$.ajax({
				type: "GET",
				contentType: "application/json",
				url: '/like/service/count?service_id='+service_id,
				data: {},
				dataType: 'json',
				cache: false,
				timeout: 600000,
				success: function (data) {
					$('#resultLikeService-'+data.companyId).html(data.numberLikes);
				},
				error: function (e) {
					console.log("ERROR : ", e);
				}
			}); 
		}
    function getSpecialities(service_id){
			$.ajax({
				type: "GET",
				contentType: "application/json",
				url: '/company/service/specialities?service_id='+service_id,
				data: {},
				dataType: 'json',
				cache: false,
				timeout: 600000,
				success: function (data) {
				  var json = data.specialities;
					$.each(json,function(index,speciality){					  
					  $('#resultSpeciality-'+service_id).append(
						 '<div style="margin-top:-1rem !important;">'
						   +'<span style="margin-top: -1rem !important;font-size: 10px; display: inline-block !important; width: 125px !important; overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">'
							+"-"+speciality.name 
						   +'</span>'
						 +'</div>'
					 );
				    });
				},
				error: function (e) {
					console.log("ERROR : ", e);
				}
			}); 
		}
	  
	function likeService(service_id){
	  $.ajax({
		  type: "GET",
		  contentType: "application/json",
		  url: '/like/service?service_id='+service_id,
		  data: {},
		  dataType: 'json',
		  cache: false,
		  timeout: 600000,
		  success: function (data) {
			  $('#resultLikeService-'+data.companyId).html(data.numberLikes);
		  },
		  error: function (e) {
			  console.log("ERROR : ", e);
		  }
	  }); 
	}

</script>