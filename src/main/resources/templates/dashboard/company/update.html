<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1000/xhtml">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Attoly</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  
  
  <link rel="stylesheet" th:href="@{/adminlte/plugins/fontawesome-free/css/all.min.css}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css}">
  <!-- iCheck -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/icheck-bootstrap/icheck-bootstrap.min.css}">
  <!-- JQVMap -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/jqvmap/jqvmap.min.css}">
  <!-- Theme style -->
  <link rel="stylesheet" th:href="@{/adminlte/dist/css/adminlte.min.css}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css}">
  <!-- Daterange picker -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/daterangepicker/daterangepicker.css}">
  <!-- summernote -->
  <link rel="stylesheet" th:href="@{/adminlte/plugins/summernote/summernote-bs4.min.css}">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.css" />
  
</head>
<style>


  @media screen and (min-width:1025px) { 
	.companyLogo{
	 width: 40%;
	}
  }
 
 @media screen and (max-width:456px) {
 	 .companyLogo {
	   width:80%;
	 }
 }
 .companyLogo{
  padding: 2rem;
 }
 .companyLogoImg{
  width:100%; 
  padding: 3px;
  height:140px !important;
  object-fit: fill;
 }
 

 

 

</style>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

   <div th:replace="dashboard/navbar"></div>
   <div th:replace="dashboard/mainsidebar"></div> 
   <div class="content-wrapper">
        <div th:replace="dashboard/header"></div>
            <!-- Main content -->
	    <section  class="content">
	     
	<!-- //TODO      
	     <div class="container">
          <br />
            <h3 align="center">Image Crop & Upload using JQuery with PHP Ajax</h3>
            <br />
            <br />
          <div class="panel panel-default">
            <div class="panel-heading">Select Profile Image</div>
            <div class="panel-body" align="center">
                <input type="file" name="upload_image" id="upload_image" accept="image/*" />
                <br />
                <div id="uploaded_image"></div>
            </div>
          </div>
        </div> 
        <div id="uploadimageModal" class="modal" role="dialog">
            <div class="modal-dialog">
             <div class="modal-content">
                   <div class="modal-header">
                     <button type="button" class="close" data-dismiss="modal">&times;</button>
                     <h4 class="modal-title">Télécharger et recadrer l'image</h4>
                   </div>
                   <div class="modal-body">
                     <div class="row">
                  <div class="col-md-8 text-center">
                   <div id="image_demo" style="width:350px; margin-top:30px"></div>
                  </div>
                  <div class="col-md-3" style="padding-top:30px; margin-left: 2rem;">
                   <br />
                   <br />
                   <br/>
                   <button class="btn btn-success crop_image">Valider </button>
                </div>
               </div>
                   </div>
                   <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                   </div>
                </div>
             </div>
           </div>-->
	      <div  class="container-fluid">
	      
	    	<form method="POST" enctype="multipart/form-data" id="fileUploadForm">
	           <input type="hidden" th:value="${company.galery.id}" name="extraField"/>
		        <div class="card companyLogo" 
		              style="border-width: 3px;
		                       border-radius: 13px ;border-color: #6FB70F;">
	 					      <img 
				                   class="companyLogoImg" id="thumbnail0"
				                   th:src="@{${awsBucketCompany}+${company.galery.id}+'/'+${company.galery.companyImage}}" alt=""
				            
				              />
	                         <input type="file" name="files"/>
	 	          </div>
	                 
		            
		            
		            
		            <div class="card" style="display: inline;"> 
					   <fieldset>
				         <legend style="font-size: medium;color: #6FB70F">Localisation <hr></legend>
					   
						   <div class="form-group">
						    <label for="exampleFormControlInput1">Vue de face</label><br>
						     
						    <img class="geolocateImg" 
						       id="thumbnail1" 
						   	  th:src="@{${awsBucketCompany}+${company.galery.id}+'/'+${company.galery.geolocateImage1}}" alt=""
						    />					  
						     <input type="file" name="files"/>
						   </div>
						 
						 
						 
						  <div class="form-group">
						    <label for="exampleFormControlInput1">Vue de loin</label><br>
						     
						    <img class="geolocateImg"
						       id="thumbnail2"
							   	  th:src="@{${awsBucketCompany}+${company.galery.id}+'/'+${company.galery.geolocateImage2}}" alt=""				   	  
						   	   />
						   	  <input type="file" name="files">
						  </div>
						   <div class="row" style="margin-left: 10%;">
						      <span style="color:  #6FB70F;" id="result"></span>					    	
			   	           </div>
		                   <div class="form-group">
							<label class="col-md-2 control-label"></label>
				              <div class="col-md-6">
				              	    <input style="position: right; color:  #6FB70F;" type="submit" value="Valider" id="btnSubmit"/>
				               </div>
						  </div>
						  </fieldset>
		            </div>
		          </form>
	      </div><!-- /.container-fluid -->
	    </section>
	    
       <!-- Other fields -->	    
	   
	    <div>
	     <div></div>
	    </div>
	   
	     <section class="content">
	      <div class="container-fluid">
	        <!-- Small boxes (Stat box) -->
	        <form class="form-horizontal" th:action="@{/company/update}" method="post"
				enctype="multipart/form-data">
	 		    <input hidden="hidden" name="id" th:value="${company.id}" />  
	             <input type="hidden" name="galery_id" th:value="${company.galery.id}" />	      
	            
	            <div class="card" style="display: inline;">
                    <div class="form-group">
					    <label for="exampleFormControlInput1">Nom</label>
					    <input  class="form-control" 
					        th:value="${company.name}"  name="name">
					  </div>
	               
				   <fieldset>
<!-- 			       <legend style="font-size: medium;color: #6FB70F">Localisation <hr></legend>
 -->				 
	                    <div class="row">
	                      <div class="form-group">
						    <label for="exampleFormControlInput1">Ville</label>
						    <input  class="form-control" 
						        th:value="${company.town}">
						  </div>
						  <div class="form-group">
						   	 <label class="control-label">* Changer</label>
							 <select name="town" class="form-control">
						       <option data-th-each="town : ${townList}" th:value="${town.name}" th:text="${town.name}">
						       </option>
						     </select>
						  </div>
                      </div>
					  <div class="form-group">
					    <label for="exampleFormControlInput1">Quartier</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.district}" name="district">
					  </div>
					 <div class="form-group">
					    <label for="exampleFormControlInput1">Adresse</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.address}" name="address">
					  </div>
					  
				   </fieldset>
				   <fieldset>
			         <legend style="font-size: medium;color:  #6FB70F">Contacts <hr></legend>	
			       	 <div class="form-group">
					    <label for="exampleFormControlInput1">T&eacute;l&eacute;phone: </label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.phone}" name="phone">
					  </div>
					  <div class="form-group">
					    <label for="exampleFormControlInput1">Email</label>
					    <input type="email" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.email}" name="email">
					  </div>
					  <div class="form-group">
					    <label for="exampleFormControlInput1">Whatsapp</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.whatsapp}" name="whatsapp">
					  </div>
					  <div class="form-group">
					    <label for="exampleFormControlInput1">Facebook</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.facebook}" name="facebook">
					  </div>
					 <div  class="form-group">
					    <label for="exampleFormControlInput1">Instagram</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.instagram}" name="instagram">
					  </div>
					  <div  class="form-group">
					    <label for="exampleFormControlInput1">Twitter</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.twitter}" name="twitter">
					  </div>
					  <div  class="form-group">
					    <label for="exampleFormControlInput1">Linkedin</label>
					    <input type="text" class="form-control" id="exampleFormControlInput1" 
					       th:value="${company.linkedin}" name="linkedin">
					  </div>					  
				   </fieldset>
	            </div>
	            	<div class="form-group">
						<div class="col-md-2"></div>
						<div class="col-md-8">
							<button type="submit" class="btn btn-success">Valider</button>
							<button class="btn btn-danger" type="reset">Annuler</button>
						</div>
					</div>
	            </form>
	        <!-- /.row -->
	        <!-- Main row -->
	
	        <!-- /.row (main row) -->
	      </div><!-- /.container-fluid -->
	    </section>
  </div>
  <aside class="control-sidebar control-sidebar-dark">
  </aside>
</div>

<!-- jQuery -->
<script th:src="@{/adminlte/plugins/jquery/jquery.min.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/adminlte/plugins/jquery-ui/jquery-ui.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>   


<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<!-- <script>
  $.widget.bridge('uibutton', $.ui.button)
</script> -->
<!-- Bootstrap 4 -->
<script th:src="@{/adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- ChartJS -->
<script th:src="@{/adminlte/plugins/chart.js/Chart.min.js}"></script>
<!-- Sparkline -->
<script th:src="@{/adminlte/plugins/sparklines/sparkline.js}"></script>
<!-- JQVMap -->
<script th:src="@{/adminlte/plugins/jqvmap/jquery.vmap.min.js}"></script>
<script th:src="@{/adminlte/plugins/jqvmap/maps/jquery.vmap.usa.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/adminlte/plugins/jquery-knob/jquery.knob.min.js}"></script>
<!-- daterangepicker -->
<script th:src="@{/adminlte/plugins/moment/moment.min.js}"></script>
<script th:src="@{/adminlte/plugins/daterangepicker/daterangepicker.js}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script th:src="@{/adminlte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js}"></script>
<!-- Summernote -->
<script th:src="@{/adminlte/plugins/summernote/summernote-bs4.min.js}"></script>
<!-- overlayScrollbars -->
<script th:src="@{/adminlte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/adminlte/dist/js/adminlte.js}"></script>
<!-- AdminLTE for demo purposes -->
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script th:src="@{/adminlte/dist/js/pages/dashboard.js}"></script>

 <script>  
           $(document).ready(function(){
            $image_crop = $('#image_demo').croppie({
        
               enableExif: true,
               viewport: {
                 width:200,
                 height:200,
                 type:'square' //circle
               },
               boundary:{
                 width:300,
                 height:300
               }
             });
           
             $('#upload_image').on('change', function(){
               var reader = new FileReader();
               reader.onload = function (event) {
                 $image_crop.croppie('bind', {
                   url: event.target.result
                 }).then(function(){
                   console.log('jQuery bind complete');
                 });
               }
               reader.readAsDataURL(this.files[0]);
               $('#uploadimageModal').modal('show');
             });
           
             $('.crop_image').click(function(event){
               $image_crop.croppie('result', {
                 type: 'canvas',
                 size: 'viewport'
               }).then(function(response){
                 $.ajax({
                   url: "/cropImage/upload",
                   type: "POST",
                   data:{"image": response},
                   success:function(data)
                   {
                     $('#uploadimageModal').modal('hide');
                     //$('#uploaded_image').html(data);
                 	$("#uploaded_image").attr("src",data);    

                   }
                 });
               })
              });
           
           });  
           </script>	

<script type="text/javascript">
		$(document).ready(function() {
		 	$("input[name='files']").each(function(index){
				$(this).change(function(){
					showExtraImageThumbnail(this,index);
				});
			}); 

			
		  function showExtraImageThumbnail(fileInput,index){
				file = fileInput.files[0];
				reader = new FileReader();
				
				reader.onload = function(e){
					$('#thumbnail'+index).attr('src',e.target.result);
				}
				reader.readAsDataURL(file);
			} 
			
		});
 </script>

<script type="text/javascript">
$(document).ready(function () {

    $("#btnSubmit").click(function (event) {

        //stop submit the form, we will post it manually.
        event.preventDefault();

        fire_ajax_submit();

    });

});

function fire_ajax_submit() {

    // Get form
    var form = $('#fileUploadForm')[0];

    var data = new FormData(form);

    data.append("CustomField", "This is some extra data, testing");

    $("#btnSubmit").prop("disabled", true);

    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/uploadCompany/update",
        data: data,
        processData: false, 
        contentType: false,
        cache: false,
        timeout: 600000,
        success: function (data) {

            $("#result").text(data);
            console.log("SUCCESS : ", data);
            $("#btnSubmit").prop("disabled", false);

        },
        error: function (e) {

            $("#result").text(e.responseText);
            console.log("ERROR : ", e);
            $("#btnSubmit").prop("disabled", false);

        }
    });

}
</script>

</body>
</html>
